{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
.list_club {
  display: flex;
  align-items: center;
  flex-direction: column;
}
.collapsible{
  background-color: #777;
  color: white;
  cursor: pointer;
  padding: 18px;
  width: 100%;
  border: none;
  text-align: center;
  outline: none;
  font-size: 15px;
  margin-bottom: 5px;
}
.collapsible2{
  background-color: #777;
  color: white;
  cursor: pointer;
  padding: 18px;
  width: 50%;
  border: none;
  text-align: center;
  outline: none;
  font-size: 20px;
}
.active, .collapsible:hover {
  background-color: #555;
}

.content, .content2{
  padding: 0 18px;
  max-height: 0;
  width: inherit;
  overflow: hidden;
  transition: max-height 0.2s ease-out;
  background-color: #f1f1f1;
  align-items: center;
}

.content p{ 
  text-align: center;
  align-items: center;
  display: flex;
  margin: 0 auto;
}


</style>
  <meta charset="utf-8">
  <title>Clubs</title>
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <meta content="Webflow" name="generator">
  <link href="{% static 'lisandros-stunning-site-01bdb5.webflow.css' %}" rel="stylesheet" type="text/css">
  <link href="{% static 'webflow.css' %}" rel="stylesheet" type="text/css">
  <link href="{% static 'lisandros-stunning-site-01bdb5.webflow.css' %}" rel="stylesheet" type="text/css">
  <link href="{% static 'favicon.ico' %}" rel="shortcut icon" type="image/x-icon">
  <link href="{% static 'webclip.png' %}" rel="apple-touch-icon">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <div data-animation="default" data-collapse="medium" data-duration="400" data-easing="ease" data-easing2="ease" role="banner" class="navbar-logo-left w-nav">
    <div class="navbarcontainer w-container">
      <div class="navbar-content">
        <div class="navbar-brand"><a href="{% url 'index' %}" class="button1"><img src="{% static 'Logo.png' %}" loading="lazy" width="117" height="56" alt="" class="logo"></a></div>
        <div class="text">
          <div class="text text"><span class="bmcconnect-0">BMC</span><span class="bmcconnect-1">C</span><span class="bmcconnect-0">onnect</span></div>
        </div>
        <nav role="navigation" class="navbar-menu w-nav-menu">
          <a href="{% url 'clubs-list' %}" class="navbar-link w-nav-link">
            <div class="text-2">Clubs</div>
          </a>
          <a href="#" class="navbar-link w-nav-link">
            <div class="text-2">Mentors</div>
          </a>
          <a href="#" class="navbar-link w-nav-link">
            <div class="text-2">search</div>
          </a>
          <a href="{% if user.is_authenticated %}{% url 'profile' %}{% else %}{% url 'signin' %}{% endif %}" class="navbar-button w-nav-link">
            <div class="text-3">
              {% if user.is_authenticated %}
                Profile
              {% else %}
                Sign In
              {% endif %}
            </div>
          </a>
          
        </nav>
      </div>
      <div class="w-nav-button">
        <div class="w-icon-nav-menu"></div>
      </div>
    </div>
  </div>
  <div class="list_club">
    {% for category in categories %}
        <h2 class="collapsible2">{{ category }}</h2>
        <div class="content2">
            {% for club in clubs %}
                {% if club.category == category %}
                    <button class="collapsible">{{ club.name }}</button>
                    <div class="content">
                        <p>Email: {{ club.email }}</p>
                        <p>Meeting Type: {{ club.meeting_type }}</p>
                        <p>Hybrid Link: {{ club.hybrid_link }}</p>
                        <p>Advisor Name: {{ club.advisor_name }}</p>
                        <p>Advisor Email: {{ club.advisor_email }}</p>
                        <p>Club Room: {{ club.club_room }}</p>
                        <p>Category: {{ club.category }}</p>
                        <p>Members: <span id="members-count-{{ club.id }}">{{ club.members.count }}</span></p>
                        {% if user.is_staff %}
                            <a href="{% url 'edit_club' club.id %}">Edit Club</a>
                        {% endif %}
                        {% if user.is_authenticated %}
                            {% if club in user.clubs.all %}
                                <button id="join-button-{{ club.id }}" onclick="joinClub({{ club.id }})">Leave Club</button>
                            {% elif club not in user.clubs.all %}
                                <button id="join-button-{{ club.id }}" onclick="joinClub({{ club.id }})">Join Club</button>
                            {% endif %}
                            {% if user.is_staff %}
                                <a href="{% url 'delete_club' club.id %}">Delete Club</a>
                            {% endif %}
                        {% endif %}
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    {% endfor %} 
        <a href="{% url 'create_club' %}" id="button1">Create Club</a>
        <script>
           function joinClub(clubId) {
        $.ajax({
            url: 'join/' + clubId + '/',
            type: 'POST',
            dataType: 'json',
            headers: {'X-CSRFToken': '{{ csrf_token }}'},
            success: function (data) {
                var joinButton = $('#join-button-' + clubId);
                var membersCountElement = $('#members-count-' + clubId);
                let count=0
                count++

                if (count>0) {
                    joinButton.text('Leave Club'); // Update button text
                } else {
                    joinButton.text('Join Club'); // Update button text
                }
                
                membersCountElement.text(data.members_count); // Update the members count
            }
        });
    }
  var collapsibleButtons = document.querySelectorAll('.collapsible');

  collapsibleButtons.forEach(function(button) {
    button.addEventListener('click', function() {
      this.classList.toggle('active');
      var content = this.nextElementSibling;
      if (content.style.maxHeight) {
        content.style.maxHeight = null;
        content.style.width = null; // Reset the width
      } else {
        content.style.maxHeight = content.scrollHeight + 'px';
        content.style.width = this.offsetWidth + 'px'; // Set the width equal to the button's width
      }
    });
  });
  var collapsibleButtons2 = document.querySelectorAll('.collapsible2');

  collapsibleButtons2.forEach(function(h2) {
    h2.addEventListener('click', function() {
      this.classList.toggle('active');
      var content = this.nextElementSibling;
      if (content.style.maxHeight) {
        content.style.maxHeight = null;
        content.style.width = null; // Reset the width
      } else {
        content.style.maxHeight = '4900px';
        content.style.width = this.offsetWidth + 'px'; // Set the width equal to the button's width
      }
    });
  });
</script> 
    </div>
      <div class="footer">
        <div class="columns-2">
          <div class="small-columns">
            <div class="column">
              <div class="content">
                <div class="text-5">COMPANY</div>
                <div class="footer-links">
                  <div class="link">How it works</div>
                  <div class="link">additional</div>
                  <div class="link">additional</div>
                </div>
              </div>
            </div>
            <div class="column">
              <div class="content">
                <div class="text-5">RESOURCES</div>
                <div class="footer-links">
                  <div class="link">Blog post name goes here</div>
                  <div class="link">Blog post name goes here</div>
                  <div class="link">Blog post name goes here</div>
                  <div class="link">See all resources</div>
                </div>
              </div>
            </div>
            <div class="column">
              <div class="content">
                <div class="text-5">ABOUT</div>
                <div class="footer-links">
                  <div class="link">Terms &amp; Conditions</div>
                  <div class="link">Privacy Policy</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="column-2">
          <div class="logo-wrapper"><img src="{% static 'Logo_1.png' %}" loading="lazy" width="287" height="68" srcset="{% static 'Logo_1-p-500.png' %}" sizes="(max-width: 479px) 60vw, 287px" alt="" class="logo-2"></div>
        </div>
        <div class="copyright">
          <div class="text-6">Copyright Â© 2023 BMCConnect</div>
        </div>
      </div>
    </div>
</body>
</html>